<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <script src="https://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>
    <link href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css" rel="stylesheet">

    <script src="http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js"></script>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./font-awesome/css/font-awesome.css">
</head>

<body>
    <header class="nav">
        <i class="arrow-left"></i>
        <span>影片详情</span>
    </header>
    <div class="page">
        <section class="movie-header">
            <div class="movie">
                <div class="movie-background"></div>
                <div class="movie-filter"></div>
                <div class="movie-container">
                    <div class="movie-cover">
                        <a href="#" class="link">
                            <img src="./images/header-bg.jpg" alt="" id="moviePic" class="img">
                        </a>
                    </div>
                    <div class="movie-content">
                        <div class="movie-name">
                            <span></span>
                        </div>
                        <div class="movie-ename">
                            <span></span>
                        </div>
                        <div class="movie-score">
                            <div class="released-score">
                                <div class="rating" id="rating">
                                    <!-- star---------- -->
                                    <span class="rating-score"></span>
                                </div>
                                <div class="score-number">
                                    (<span></span>)人评分
                                </div>
                            </div>
                        </div>
                        <div class="movie-detail">
                            <p class="movie-type"></p>
                            <p class="address-time">
                                <span class="address">zg</span>
                                <span class="time">111</span>分钟
                            </p>
                            <p class="date"></p>
                            <p class="desc"></p>
                        </div>
                    </div>
                </div>
                <div class="operating flex">
                    <div class="movie-watch flex1" id="movie-watch">
                        <img src="./images/heart.png" alt="">
                        <span>想看</span>
                    </div>
                    <div class="movie-mark flex1">
                        <img src="./images/star2.png" alt="">
                        <span>评分</span>
                    </div>
                </div>
            </div>
        </section>
        <!-- section2 -->
        <section class="section-seperate section-expander">
            <div class="text-expander" id="text-expander">
                <div class="text-expander_content close">
                    <p></p>
                </div>
                <div class="text-expander_button">
                    <i class="icon-chevron_down"></i>
                </div>
            </div>
        </section>
        <!-- section3 -->
        <section class="section-seperate">
            <p class="action-list section-til">演职人员</p>
            <ul class="movie-celebrities">
                <!-- <li>
                    <a href="#" class="link">
                        <div class="movie-celebrities__pic">
                            <img src="http://p1.meituan.net/moviemachine/6e06b1eee9a74c9573fdb8150fb8561271624.jpg@130w_180h.webp"
                                alt="">
                        </div>
                        <span class="movie-celebrities__nick">dsfsd</span>
                        <span class="movie-celebrities__roles">dsfsd</span>
                    </a>
                </li> -->

            </ul>
        </section>
        <!-- section4 -->
        <section class="movie-booking section-seperate section-expander">
            <p class="section-til">票房</p>
            <div class="weui-flex">
                <div class="weui-flex__item">
                    <div class="placeholder">
                        <span class="pf1">1</span>
                        <p>昨日票房(万)</p>
                    </div>
                </div>
                <div class="weui-flex__item">
                    <div class="placeholder">
                        <span class="pf2">2</span>
                        <p>周票房(万)</p>
                    </div>
                </div>
                <div class="weui-flex__item">
                    <div class="placeholder">
                        <span class="pf3">3</span>
                        <p>总票房(万)</p>
                    </div>
                </div>
            </div>
        </section>
        <!-- section 5 -->
        <section class="movie-photo section-seperate">
            <p class="action-list section-til">视频和剧照</p>
            <ul class="movie-photo__list">
                <!-- <li class="stage-img__container">
                    <a href="" class="link">
                        <div class="movie-celebrities__pic">
                            <img src="http://p1.meituan.net/moviemachine/6e06b1eee9a74c9573fdb8150fb8561271624.jpg@130w_180h.webp"
                                alt="">
                        </div>
                    </a>
                </li> -->
            </ul>
        </section>
        <!-- section6 -->
        <section class="section-seperate section-expander">
            <p class="section-til pos_r">讨论
                <span class="join-comment">参与讨论</span>
            </p>
            <ul class="movie-comment">
                <li class="comment-item">
                    <div class="comment-item__sort">
                        <span>全部</span>
                        <span class="comment-item_num all">1314</span>
                    </div>
                </li>
                <li class="comment-item">
                    <div class="comment-item__sort">
                        <span>好评</span>
                        <span class="comment-item_num good">287</span>
                    </div>
                </li>
                <li class="comment-item">
                    <div class="comment-item__sort">
                        <span>差评</span>
                        <span class="comment-item_num bad">11</span>
                    </div>
                </li>
                <li class="comment-item">
                    <div class="comment-item__sort">
                        <span>点映</span>
                        <span class="comment-item_num dY">106</span>
                    </div>
                </li>
                <li class="comment-item">
                    <div class="comment-item__sort">
                        <span>购票</span>
                        <span class="comment-item_num gP">123</span>
                    </div>
                </li>
                <li class="comment-item">
                    <div class="comment-item__sort">
                        <span>认证作者</span>
                        <span class="comment-item_num rZ">12</span>
                    </div>
                </li>
                <li class="comment-item">
                    <div class="comment-item__sort">
                        <span>同城</span>
                        <span class="comment-item_num tC">666</span>
                    </div>
                </li>
            </ul>
        </section>
        <!-- section7 -->
        <section class="section-seperate section-expander">
            <p class="section-til">精选</p>
            <ul class="chosen-comment" id="chosen-cpmment">
                <li class="chosen-comment__item">
                    <div class="item-avatal">
                        <img src="https://ss1.baidu.com/6ONXsjip0QIZ8tyhnq/it/u=3230445748,1342490172&fm=58" alt="">
                    </div>
                    <div class="item-detail">
                        <div class="item-detail__hd">
                            <div>
                                <span class="nick-name">问题</span>
                                <span class="level">
                                    <img src="" alt="">
                                </span>
                            </div>
                            <p class="item-score__desc">给这部电影打了<span>10</span>分</p>
                        </div>
                        <div class="item-detail__content">
                            <p></p>
                        </div>
                        <div class="item-detail__footer">
                            <span class="item-detail__time">03-22</span>
                            <div class="pull-right">
                                <a href="#" class="link comment-like">
                                    <i class="icon icon-approve fa fa-thumbs-o-up"></i>
                                    <span>32423</span>
                                </a>
                                <a href="#" class="link comment-reply">
                                    <i class="fa fa-commenting icon-approve icon"></i>
                                    <span>21221</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </section>
        <!-- tost -->
        <div id="toast">
            <div class="wweui-mask_transparent"></div>
            <div class="weui-toast">
                <i class="weui-icon-success-no-circle weui-icon_toast"></i>
                <p class="weui-tost_content"></p>
            </div>
        </div>
    </div>
    <script>
        (function () {
            $.ajax({   //ajax 拿接口 后太数据 去渲染页面
                url: 'https://www.easy-mock.com/mock/5ca2c29464930718b239eb94/lm/lvmeng/myMovie-demo',
                type: 'get',
                success: function (res) {
                    console.log(res);
                    // $('#moviePic').attr('src',res.data.moviePic);
                    $('.movie-content .movie-name span').html(res.data.name);
                    $('.movie-content .movie-ename span').html(res.data.nameEnglish)
                    star(res.data.star);
                    $('.rating-score').html(res.data.grade);
                    $('.score-number span').html(res.data.people);
                    $('.movie-type').html(res.data.type);
                    $('.address-time .address').html(res.data.where);
                    $('.address-time .time').html(res.data.time);
                    $('.movie-detail .date').html(res.data.date);
                    $('.text-expander_content p').html(res.data.desc);
                    celebrity(res.data.person);
                    // $('.placeholder .pf1').html(res.data.booking.ranking);
                    // $('.placeholder .pf2').html(res.data.booking.bookingWeek);
                    // $('.placeholder .pf3').html(res.data.booking.bookingTotal);
                    piaofang(res.data.booking);
                    photo(res.data.pictures);
                    commentNum(res.data.commentNum);
                    all(res.data.commentTotal);
                    // console.log(res.data.commentTotal);

                    comments(res.data.comment);
                    // console.log(res.data.comment[0].avatal)
                    // console.log(res.data.comment.length);
                }
            })
            function star(e) {
                let num = Math.floor(e); //向下取整
                if (e > num) {
                    $('#rating').prepend('<img class="img" src="./images/star-h.png">')
                }
                for (let i = 0; i < num; i++) {
                    $('#rating').prepend('<img class="img" src="./images/star.png">') //div 开始之前插入
                }
            }

            $('#movie-watch').click(function () {
                if ($(this).hasClass('active')) {
                    $('#movie-watch').removeClass('active')
                    $('#movie-watch img').attr('src', './images/heart.png')
                    $('#toast .weui-tost_content').html('已取消想看')
                } else {
                    $('#movie-watch').addClass('active');
                    $('#movie-watch img').attr('src', './images/heart1.png');
                    $('#toast .weui-tost_content').html('已标记为想看');
                }
                $('#toast').css('display', 'block');
                setTimeout(() => {
                    $('#toast').css('display', 'none')
                }, 1500)
                // console.log('好看')
            })
            //收放详情
            $('.text-expander_button').on('click', function () {
                if ($('.text-expander_content').hasClass('close')) {
                    $('.text-expander_content').removeClass('close')
                    $('.icon-chevron_down').addClass('up')
                } else {
                    $('.text-expander_content').addClass('close')
                    $('.icon-chevron_down').removeClass('up')

                }
            })
            //演员表
            function celebrity(arr) {
                for (let n of arr) {
                    $('.movie-celebrities').append(`<li><a href="#" class="link">
                        <div class="movie-celebrities__pic">
                            <img src="${n.avatal}"
                                alt="">
                        </div>
                        <span class="movie-celebrities__nick">${n.name}</span>
                        <span class="movie-celebrities__roles">${n.sort}</span>
                    </a></li>`);
                }
            }
            //票房
            function piaofang(pf) {
                $('.pf1').html(pf.ranking);
                $('.pf2').html(pf.bookingWeek);
                $('.pf3').html(pf.bookingTotal);

            }
            // 剧照
            function photo(p) {
                for (let i of p) {
                    $('.movie-photo__list').append(`<li class="stage-img__container">
                    <a href="#" class="link">
                        <div class="movie-celebrities__pic">
                            <img src="${i}"
                                alt="">
                        </div>
                    </a>
                </li>`)
                }
            }
            //commentNum
            function commentNum(c) {
                // $('.all').html(c.author);
                $('.good').html(c.good);
                $('.bad').html(c.bad);
                $('.dY').html(c.dy);
                $('.gP').html(c.bought);
                $('.rZ').html(c.author);
                $('.tC').html(c.sameCity);
            }
            //all
            function all(a) {
                $('.all').html(a);
            }
            //评论
            function comments(pl) {
                for (let n of pl) {
                    $('.chosen-comment').append(`<li class="chosen-comment__item">
                    <div class="item-avatal">
                        <img src="${n.avatal}" alt="">
                    </div>
                    <div class="item-detail">
                        <div class="item-detail__hd">
                            <div>
                                <span class="nick-name">${n.nickName}</span>
                                <span class="level">
                                    <img src="${n.lever}" alt="">
                                </span>
                            </div>
                            <p class="item-score__desc">给这部电影打了<span>${n.grade}</span>分</p>
                        </div>
                        <div class="item-detail__content">
                            <p>${n.detail}</p>
                        </div>
                        <div class="item-detail__footer">
                            <span class="item-detail__time">${n.date}</span>
                            <div class="pull-right">
                                <a href="#" class="link comment-like">
                                    <i class="icon icon-approve fa fa-thumbs-o-up"></i>
                                    <span>${n.like}</span>
                                </a>
                                <a href="#" class="link comment-reply">
                                    <i class="icon icon-cpmment fa fa-commenting "></i>
                                    <span>${n.reply}</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </li>`)
                }
            }
            //评论点赞

            $('.link .icon').click(function () {
                if ($('.link .icon').hasClass('fa-thumbs-o-up')) {
                    $('.link .icon').removeClass('fa-thumbs-o-up');
                    $('.link .icon').addClass('fa-thumbs-up')
                }
            })
            //取消

        })()
    </script>
</body>

</html>